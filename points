
color: #D98200 暗橙色
color: #FF9900 橙色
color: #444A54 黑灰色
color: #797979 浅灰色
color: #686868 深灰色
color: #EEEEEE 淡灰色
color: #


=================================\points\usr\master\filters\filters.php

<?php require_once $_SERVER['DOCUMENT_ROOT'] . '/points/usr/master/master.inc.php'; ?>
<!DOCTYPE html>
<html>
    <head>
       <?php points::head(0); ?>
       <link rel="stylesheet" href="/points/usr/local/css/master.css" />
       <link rel="stylesheet" href="/points/usr/local/css/grids.css" />
       <script src="/points/usr/local/js/f.js"></script>
       <script src="js/filters.js"></script>
    </head>
    <body>
        <div id="outset">
            <div id="topic"><h1>管理用户数据过滤器</h1><span id="err"></span></div>
            <table id="grids">
                <thead>
                    <tr>
                        <td class="width6">编号</td>
                        <td>过滤器名称</td>
                        <td>过滤器字段内容</td>
                        <td>过滤器搜索选项</td>
                        <td>SQL</td>
                        <td>状态</td>
                        <td>创建时间</td>
                    </tr>
                </thead>
                <tbody>
                    <tr id="loading"><td colspan="7">loading data！please wait......</td></tr>
                </tbody>
                <tfoot>
                    <tr><td colspan="7"><span id="oper">&nbsp</span><span id="fpage">&nbsp</span></td></tr>
                </tfoot>
            </table>
        </div>
        <div id="tip">
            <p class="first">友情提示：顶部的搜索框可以按<strong>过滤器名称</strong>模糊搜索输入搜索条件后可以按下回车<strong>ENTER</strong>键或者旁边的搜索小图标</p>
        </div>
    </body>
</html>

=================================\points\usr\master\filters\filters.php

=================================\points\usr\master\filters\js\filters.js
$(document).ready(function(){
    posts.page = 1;//默认显示第一页
    f.grid('ask/filters.ajx.php');
    
    //编辑过滤器
    $('#grids tfoot tr td').delegate('#edit','click',function(){ 
        var tr = $('#grids tbody .checked');
        var err = document.getElementById('err');
        if (tr.length == 0) { err.innerHTML = '没有条目选中'; return; }
        if (tr.length > 1) { err.innerHTML = '一次只能编辑一个条目'; return; }
        err.innerHTML = '';
        var id = tr.find(':first-child').text();
        window.location.href="filters.oper.php?fid=" + id;    
    });
    
    //删除过滤器
    $('#grids tfoot tr td').delegate('#delete','click',function(){
        var tr = $('#grids tbody .checked');
        var err = document.getElementById('err');
        if (tr.length == 0) { err.innerHTML = '没有条目选中'; return; }
        err.innderHTML = '';
        var id = [];
        tr.each(function(i,obj){
            id.push($(obj).find(':first-child').text());        
        });
        if (window.confirm('你确定要删除这些条目吗？'))
        {
            $.post('ask/filters.delete.ajx.php',{"id":id.join('|')},function(r){
                var j = $.parseJSON(r);
                $('#err').text(j.message);
            });        
        }        
    });
    
    //搜索功能
    $('#searcher',window.top.document).keyup(function(e){
        var v = $(this).val();
        if(e.which == 13)
        {
            posts.searcher = v;
            f.grid('ask/filters.ajx.php');
        }
    });
    $('#ico-search',window.top.document).click(function(){
        var v = $(this).parent().find('#searcher').val();
        posts.searcher = v;
        f.grid('ask/filters.ajx.php');
    });   

});

=================================\points\usr\master\filters\js\filters.js

=================================\points\usr\master\filters\ask\filters.ajx.php
<?php
    require_once $_SERVER['DOCUMENT_ROOT'] . '/points/usr/master/master.inc.php';
    $_SESSION['authority'] = '1111000110';
    
    //返回的数据
    $set = array('status'=>0,'page'=>$_POST['page'],'pageTotal'=>0,'tbody'=>'','operations'=>'','fpage'=>'');
    
    //校验一下$page 必须为一个整数
    if(!ctype_digit($set['page'])){ exit; /**异常的参数传入*/ }
    
    //获取符合条件的总数并处理分页
    $filter = new filter();
    $pageSize = 15; //分页大小
    $set['pageTotal'] = ceil($filter->rows() / $pageSize);
    $limit = $pageSize . ' OFFSET ' . ($set['page'] - 1) * $pageSize;
    
    //搜索设置
    if(isset($_POST['searcher']) && !empty($_POST['searcher']))
    { 
        $search = trim($_POST['searcher']);  $where = "name LIKE '%{$search}%'";
        
    }else{ $where = ''; }
    
    //获取数据
    $filter = new filter($where,array('order'=>'createTime DESC','limit'=>$limit));
    $filters  = $filter->get(array('id','name','fieldText','searcher','SQL','status','createTime'));
    
    //准备显示的内容
    $tbody = '';
    for($i=0;$i<$filter->iTotal();$i++)
    {
        $tbody .= '<tr><td class="width6">' . $filters['id'][$i] . '<label class="selected"></label></td>';
        $tbody .= '<td>' . $filters['name'][$i] . '</td>';
        $tbody .= '<td>' . $filters['fieldText'][$i] . '</td>';
        $tbody .= '<td class="left">' . $filters['searcher'][$i] . '</td>';
        $tbody .= '<td class="left">' . $filters['SQL'][$i] . '</td>';
        $tbody .= '<td>' . $filters['status'][$i] . '</td>';
        $tbody .= '<td>' . $filters['createTime'][$i] . '</td></tr>';   
    }
    if($filter->iTotal() > 0) //有可用数据提供显示
    {
        $set['status'] = 1;
        $set['tbody'] = $tbody;
        $set['operations'] = points::authorized($_SESSION['authority'],array('add','apply','import','export'));
        $fpage = points::fpage($set['pageTotal'],$set['page'],$pageSize);
        $set['fpage'] = empty($fpage) ? '&nbsp' : $fpage;
    }else
    {
        $set['status'] = 2;
        $set['operations'] = '&nbsp;';
        $set['fpage'] = empty($fpage) ? '&nbsp;' : $fpage;
    }    
    points::jan($set);
?>
=================================\points\usr\master\filters\ask\filters.ajx.php

=================================\points\usr\master\filters\ask\filters.delete.ajx.php
<?php
    require $_SERVER['DOCUMENT_ROOT'] . '/points/usr/master/master.inc.php';
    
    if(empty($_POST['id'])){ echo points::jen(0,'没有条目选中，异常的请求！'); exit; }
    
    $arr = explode('|',$_POST['id']);
    $len = count($arr);
    //校验用户输入
    for($i=0;$i<$len;$i++){  if(!ctype_digit($arr[$i])){ echo points::jen(0,'包含了异常的请求！'); exit; }   }
    
    //删除条目
    $where = ' id IN(' . implode(',',$arr) . ')';
    $filter = new filter($where);
    if($filter->delete())
    {
        echo points::jen(1,'删除了共 ' . $len . ' 个条目,请刷新当前页面！');exit;
        
    }else{ echo points::jen(0,'删除失败');exit; }
?>
=================================\points\usr\master\filters\ask\filters.delete.ajx.php
